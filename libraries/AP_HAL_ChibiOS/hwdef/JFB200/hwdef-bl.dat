## hw definition file for processing by chibios_hwdef.py
## for the JFB200 hardware

## board ID for firmware load
APJ_BOARD_ID 1200

## MCU class and specific type
MCU STM32H7xx STM32H755xx
define CORE_CM7
#define SMPS_PWR

## crystal frequency 24MHz
OSCILLATOR_HZ 24000000

## the H755 has 128k sectors
## the location where the bootloader will put the firmware
FLASH_BOOTLOADER_LOAD_KB 128

## bootloader is installed at zero offset
FLASH_RESERVE_START_KB 0

## with 2M flash we can afford to optimize for speed
FLASH_SIZE_KB 2048

## Starage size
HAL_STORAGE_SIZE 32768

## USB setup
#USB_VENDOR  0x0A8E  # JAE
#USB_PRODUCT 0x8888  # This is temp Number
USB_STRING_MANUFACTURER "Japan Aviation Electronics Industry Ltd."
USB_STRING_PRODUCT "JFB-200"

## ChibiOS system timer
STM32_ST_USE_TIMER 2

## optimize
env OPTIMIZE -Os

## order of UARTs (and USB)
## SERIAL   | 0  |  1  |  2  |  3   |
SERIAL_ORDER OTG1 UART7 UART5 UART4

## serial port for stdout, set SERIAL3_PROTOCOL 0(none) when using
## The value for STDOUT_SERIAL is a serial device name, and must be for a 
## serial device for which pins are defined in this file. For example, SD3
## is for USART3 (SD3 == "serial device 3" in ChibiOS).
STDOUT_SERIAL SD4
STDOUT_BAUDRATE 921600

## default to all pins low to avoid ESD issues
DEFAULTGPIO OUTPUT LOW PULLDOWN

## USB OTG1 SERIAL0
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

## pins for SWD debugging
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

## telem1 
PE8  UART7_TX  UART7 SPEED_VERYLOW
PE10 UART7_CTS UART7 SPEED_VERYLOW
PE7  UART7_RX  UART7 SPEED_VERYLOW
PF8  UART7_RTS UART7 SPEED_VERYLOW

## telem2
PC12 UART5_TX  UART5 SPEED_VERYLOW
PC9  UART5_CTS UART5 SPEED_VERYLOW
PD2  UART5_RX  UART5 SPEED_VERYLOW
PC8  UART5_RTS UART5 SPEED_VERYLOW

## telem3
PD8  USART3_TX  USART3 SPEED_VERYLOW
PD11 USART3_CTS USART3 SPEED_VERYLOW
PD9  USART3_RX  USART3 SPEED_VERYLOW
PD12 USART3_RTS USART3 SPEED_VERYLOW

## GPS1
PA9  USART1_TX USART1 SPEED_VERYLOW
PB7  USART1_RX USART1 SPEED_VERYLOW

## GPS2
PD5  USART2_TX  USART2  SPEED_VERYLOW
#PD3  USART2_CTS USART2  SPEED_VERYLOW  # TL6
PA3  USART2_RX  USART2  SPEED_VERYLOW
#PD4  USART2_RTS USART2  SPEED_VERYLOW  # TL7

## RC input or Ext UART
PE1  UART8_TX UART8 SPEED_VERYLOW
PE0  UART8_RX UART8 SPEED_VERYLOW  # UART8_RX_SBUS

## SBUS OUT or Ext UART
PG14 USART6_TX USART6 SPEED_VERYLOW
PG9  USART6_RX USART6 SPEED_VERYLOW

## debug uart
PH13 UART4_TX UART4 SPEED_VERYLOW NODMA
PH14 UART4_RX UART4 SPEED_VERYLOW NODMA

## VDD Sense Pins
## Now the VDD sense pin. This is used to sense primary board voltage.
PH4  VDD_5V_SENS            INPUT  # ADC3_15
PA10 VBUS_RESERVED          INPUT
PF11 SCALED_V3V3            INPUT  # ADC1_2

## JFB200 has SERVORAIL ADC
PH3  FMU_SERVORAIL_VCC_SENS INPUT  # ADC3_14

## This defines an output pin which will default to output HIGH. It is
## a pin that enables peripheral power on this board. It starts in the
## off state, then is pulled low to enable peripherals in
## peripheral_power_enable()
PG10 nVDD_5V_HIPOWER_EN  OUTPUT HIGH  # VDD_5V_HIGHPOWER_CEn
PK1  nVDD_5V_PERIPH_EN   OUTPUT HIGH  # VDD_5V_PERIPH_CEn
PJ2  VDD_3V3_SENSORS_EN  OUTPUT LOW
PG0  VDD_3V3_SENSORS2_EN OUTPUT LOW   # VDD_3V3_GPS_EN
PJ4  VDD_3V3_SENSORS3_EN OUTPUT LOW   # BUZZER_VCC_EN

#PI13 nVDD_3V3_SD_CARD_EN OUTPUT HIGH  # HEATER_CEn
PI13 HEATER_CEn          OUTPUT HIGH  # HEATER_CEn

## Control of Spektrum power pin
## no SPEKTRUM_RC pin so this is controlled manually
PA15  SPEKTRUM_PWR       OUTPUT LOW

## CS pins
PK5   FRAM_SPI1_CS      CS    SPEED_VERYLOW  # SPI1_CS
PJ3   IMU3_SPI1_CS      CS    SPEED_VERYLOW  # SPI1_CS

PB10  BARO1_SPI2_CS     CS    SPEED_VERYLOW  # SPI2_CS
PI4   IMU1_SPI2_CS      CS    SPEED_VERYLOW  # SPI2_CS

PI10  IMU2_SPI3_CS      CS    SPEED_VERYLOW  # SPI3_CS
PB11  BARO2_SPI3_CS     CS    SPEED_VERYLOW  # SPI3_CS

PH15  BARO3_SPI4_CS     CS    SPEED_VERYLOW  # SPI4_CS
PG6   EEPROM_SPI4_CS    CS    SPEED_VERYLOW  # SPI4_CS

PE2   EXT_SPI5_CS       CS    SPEED_VERYLOW  # SPI5_CS

## PWM output pins
PE9  PWMOUT1  OUTPUT LOW
PJ11 PWMOUT2  OUTPUT LOW
PJ9  PWMOUT3  OUTPUT LOW
PE14 PWMOUT4  OUTPUT LOW
PC6  PWMOUT5  OUTPUT LOW
PC7  PWMOUT6  OUTPUT LOW
PB0  PWMOUT7  OUTPUT LOW
PB1  PWMOUT8  OUTPUT LOW
PB6  PWMOUT9  OUTPUT LOW
PD13 PWMOUT10 OUTPUT LOW
PD14 PWMOUT11 OUTPUT LOW
PD15 PWMOUT12 OUTPUT LOW
PI5  PWMOUT13 OUTPUT LOW
PI6  PWMOUT14 OUTPUT LOW
PI7  PWMOUT15 OUTPUT LOW
PI2  PWMOUT16 OUTPUT LOW
PK2  PWM_OEn                  OUTPUT HIGH
PJ6  PWM_VOLTAGE_SEL_5V_3Vn   OUTPUT LOW
]
## CAN bus
PK4  GPIO_CAN_SILENT OUTPUT PUSHPULL LOW  # CAN_OEn

## armed indication
PF2 nARMED OUTPUT HIGH SPEED_VERYLOW

## microSD
PD6  SDMMC2_CK  SDMMC2 SPEED_LOW
PD7  SDMMC2_CMD SDMMC2 SPEED_LOW
PB14 SDMMC2_D0  SDMMC2 SPEED_LOW
PB15 SDMMC2_D1  SDMMC2 SPEED_LOW
PB3  SDMMC2_D2  SDMMC2 SPEED_LOW
PB4  SDMMC2_D3  SDMMC2 SPEED_LOW
define FATFS_HAL_DEVICE SDCD2
PC13 SD_CARD_IN INPUT

## LEDs
PE3 LED_RED   OUTPUT OPENDRAIN LOW  SPEED_VERYLOW
PE4 LED_GREEN OUTPUT OPENDRAIN HIGH SPEED_VERYLOW
PE5 LED_BLUE  OUTPUT OPENDRAIN LOW  SPEED_VERYLOW

define HAL_LED_ON 0

## enable DFU by default
#ENABLE_DFU_BOOT 1


## Ethernet
PH2 GPIO_ETH_ENABLE OUTPUT LOW SPEED_VERYLOW  # ETH_RMII_POWER_EN



