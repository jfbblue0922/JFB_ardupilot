# hw definition file for processing by chibios_hwdef.py
# for the JFB200 hardware

# MCU class and specific type
MCU STM32H7xx STM32H755xx

define CORE_CM7
#define SMPS_PWR

# ChibiOS system timer
STM32_ST_USE_TIMER 2

# crystal frequency 24MHz
OSCILLATOR_HZ 24000000

# USB setup
# USB_VENDOR 0x0A8E  # JAE
# USB_PRODUCT 0x8888 # This is temp Number
USB_STRING_MANUFACTURER "JAE"
USB_STRING_PRODUCT "JFB-200"

# board ID for firmware load
APJ_BOARD_ID 1200

# bootloader is installed at zero offset
FLASH_RESERVE_START_KB 0

# the H755 has 128k sectors
# the location where the bootloader will put the firmware
FLASH_BOOTLOADER_LOAD_KB 128

# with 2M flash we can afford to optimize for speed
FLASH_SIZE_KB 2048

HAL_STORAGE_SIZE 32768

env OPTIMIZE -Os

# order of UARTs (and USB)
SERIAL_ORDER OTG1 UART7 UART5 USART3

# serial port for stdout, set SERIAL7_PROTOCOL 0(none) when using
# The value for STDOUT_SERIAL is a serial device name, and must be for a 
# serial device for which pins are defined in this file. For example, SD3
# is for USART3 (SD3 == "serial device 3" in ChibiOS).
STDOUT_SERIAL SD3
STDOUT_BAUDRATE 921600

# default to all pins low to avoid ESD issues
DEFAULTGPIO OUTPUT LOW PULLDOWN

# USB OTG1 SERIAL0
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

# pins for SWD debugging
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# CS pins
PK5   FRAM_SPI1_CS      CS  # SPI1_CS
PJ3   IMU3_SPI1_CS      CS  # SPI1_CS
PF2   BARO1_SPI2_CS     CS  # SPI2_CS
PI4   IMU1_SPI2_CS      CS  # SPI2_CS
PI10  IMU2_SPI3_CS      CS  # SPI3_CS
PI9   BARO2_SPI3_CS     CS  # SPI3_CS
PH15  BARO3_SPI4_CS     CS  # SPI4_CS
PG6   EEPROM_SPI4_CS    CS  # SPI4_CS
PE2   EXT_SPI5_CS       CS  # SPI5_CS

# telem1 
PE8  UART7_TX  UART7
PE10 UART7_CTS UART7
PE7  UART7_RX  UART7
PF8  UART7_RTS UART7

# telem2
PC12 UART5_TX  UART5
PC9  UART5_CTS UART5
PD2  UART5_RX  UART5
PC8  UART5_RTS UART5

# telem3
PA3  USART2_RX  USART2
PD3  USART2_CTS USART2
PD4  USART2_RTS USART2
PD5  USART2_TX  USART2

# GPS1
PB6  USART1_TX USART1
PB7  USART1_RX USART1

# uart4
PH13 UART4_TX UART4
PH14 UART4_RX UART4

# Tx Only for SBUS OUT
PG14 USART6_TX USART6

# Rx Only for RC input
PE0  UART8_RX UART8
PE1  UART8_TX UART8

# debug uart
PD8  USART3_TX USART3 NODMA
PD9  USART3_RX USART3 NODMA

# armed indication
PB10 nARMED OUTPUT HIGH

# start peripheral_power_enable()
PG10 nVDD_5V_HIPOWER_EN         OUTPUT HIGH  # VDD_5V_HIGHPOWER_CEn
PK1  nVDD_5V_PERIPH_EN          OUTPUT HIGH  # VDD_5V_PERIPH_CEn
PJ2  VDD_3V3_SENSORS_EN         OUTPUT LOW   
PG0  VDD_3V3_SENSORS2_EN        OUTPUT LOW   # VDD_3V3_GPS_EN
PJ4  VDD_3V3_SENSORS3_EN        OUTPUT LOW   # BUZZER_VCC_EN
PI13 nVDD_3V3_SD_CARD_EN        OUTPUT HIGH  # HEATER_CEn
PA15 SPEKTRUM_PWR               OUTPUT LOW
PH2  Ethernet_PWR_EN            OUTPUT LOW
PK4  GPIO_CAN_SILENT            OUTPUT HIGH  # CAN_OEn

# PWM output pins
PE9  PWMOUT1  OUTPUT LOW
PJ11 PWMOUT2  OUTPUT LOW
PA10 PWMOUT3  OUTPUT LOW
PE14 PWMOUT4  OUTPUT LOW
PC6  PWMOUT5  OUTPUT LOW
PC7  PWMOUT6  OUTPUT LOW
PB0  PWMOUT7  OUTPUT LOW
PB1  PWMOUT8  OUTPUT LOW
PD12 PWMOUT9  OUTPUT LOW
PD13 PWMOUT10 OUTPUT LOW
PD14 PWMOUT11 OUTPUT LOW
PD15 PWMOUT12 OUTPUT LOW
PI5  PWMOUT13 OUTPUT LOW
PI6  PWMOUT14 OUTPUT LOW
PI7  PWMOUT15 OUTPUT LOW
PI2  PWMOUT16 OUTPUT LOW
PK2  PWM_OEn  OUTPUT HIGH
PJ6  PWM_VOLTAGE_SEL_5V_3Vn OUTPUT LOW

# LEDs
PE3 DUMMY1 OUTPUT LOW #RED
PE4 LED_BOOTLOADER OUTPUT HIGH #GREEN
#PE5 LED_ACTIVITY   OUTPUT HIGH #BLUE
PE5 DUMMY2 OUTPUT LOW #BLUE
define HAL_LED_ON 0

#define HAL_USE_EMPTY_STORAGE 1
#define HAL_STORAGE_SIZE 32768

# microSD support
PD6  SDMMC2_CK  SDMMC2
PD7  SDMMC2_CMD SDMMC2
PB14 SDMMC2_D0  SDMMC2
PB15 SDMMC2_D1  SDMMC2
PB3  SDMMC2_D2  SDMMC2
PB4  SDMMC2_D3  SDMMC2
define FATFS_HAL_DEVICE SDCD2
PC13 SD_CARD_EN INPUT

# enable DFU by default
#ENABLE_DFU_BOOT 1

PG7  TERMCAN1 OUTPUT  HIGH  SPEED_VERYLOW
PG8  TERMCAN2 OUTPUT  HIGH  SPEED_VERYLOW
